#!/bin/sh

set -ex

die () { echo $@ ; exit 1; }

. ../../../nvm.sh

echo "v0.10.28" > .nvmrc
OUTPUT="$(nvm use 2>&1 >/dev/null | awk 'NR==1')"
EXPECTED_OUTPUT='N/A: version "v0.10.28" is not yet installed.'
TESTTT="$(nvm use 2>&1 >/dev/null)"
TESTT="$(nvm use 2>&1)"
TEST="$(nvm use)"

[ "_$OUTPUT" = "_$EXPECTED_OUTPUT" ] \
  || die "'nvm use' did not output: '$EXPECTED_OUTPUT'; got: '$OUTPUT'; Normal: $TEST; with 2>&1: $TESTT; with /null: $TESTTT"

OUTPUT="$(nvm use 2>&1 >/dev/null | awk 'NR==3')"
EXPECTED_OUTPUT='You need to run "nvm install v0.10.28" to install it before using it.'

[ "_$OUTPUT" = "_$EXPECTED_OUTPUT" ] \
  || die "'nvm use' did not output: '$EXPECTED_OUTPUT'; got: '$OUTPUT'"
